/* eslint-disable jsx-a11y/anchor-is-valid */
import Link from 'next/link'
import styled from 'styled-components'
import { useState, useEffect, forwardRef, HTMLAttributes } from 'react'

const Bar = styled.div`
  display: flex;
  flex-direction: row;
  align-items: center;
  justify-content: space-between;
  width: 100%;
  padding: 1rem 2rem;
  background: transparent;
  position: fixed;
  top: 0;
  transition: top 0.3s;
  z-index: 10;
  background-color: var(--white-100);
`

const Logo = styled.svg`
  display: block;
  height: 45px;
  max-width: 100%;
  margin-right: 2rem;
  box-sizing: content-box;
  width: 113px;
  fill: var(--energy-red-100);
`
const SrText = styled.span`
  border: 0;
  padding: 0;
  margin: 0;
  position: absolute !important;
  height: 1px;
  width: 1px;
  overflow: hidden;
  clip: rect(1px 1px 1px 1px); /* IE6, IE7 - a 0 height clip, off to the bottom right of the visible 1px box */
  clip: rect(1px, 1px, 1px, 1px); /*maybe deprecated but we need to support legacy browsers */
  clip-path: inset(50%); /*modern browsers, clip-path works inwards from each corner*/
  white-space: nowrap; /* added line to stop words getting smushed together (as they go onto seperate lines and some screen readers do not understand line feeds as a space */
`
export type TopbarProps = {
  height: number
} & HTMLAttributes<HTMLDivElement>

export const Topbar = forwardRef<HTMLDivElement, TopbarProps>(function Topbar({ children, height }, ref) {
  const [prevScrollPos, setPrevScrollPos] = useState(0)
  const [isVisible, setIsVisible] = useState(true)

  useEffect(() => {
    const handleScroll = () => {
      const currentScrollPos = window.pageYOffset
      setIsVisible(
        (prevScrollPos > currentScrollPos && prevScrollPos - currentScrollPos > height) ||
          currentScrollPos < prevScrollPos,
      )
      setPrevScrollPos(currentScrollPos)
    }

    window.addEventListener('scroll', handleScroll)
    return () => window.removeEventListener('scroll', handleScroll)
  }, [prevScrollPos, isVisible, height])

  return (
    <Bar ref={ref} style={{ top: isVisible ? 0 : -height }}>
      <Link href="/">
        <a>
          <Logo
            viewBox="0 0 402 160"
            xmlns="http://www.w3.org/2000/svg"
            xmlnsXlink="http://www.w3.org/1999/xlink"
            aria-hidden
          >
            <path d="M300.704,29.427L300.705,65.692C300.704,66.766 301.242,67.759 302.174,68.295L333.597,86.398C334.93,87.166 336.63,86.204 336.631,84.665L336.631,48.402C336.632,47.327 336.058,46.334 335.127,45.797L303.705,27.696C302.371,26.927 300.706,27.889 300.704,29.427M397.488,1.111L352.25,27.173C350.909,27.945 350.084,29.374 350.086,30.921L350.086,83.13C350.088,85.346 352.534,86.73 354.454,85.624L399.693,59.563C401.033,58.79 401.808,57.361 401.807,55.814L401.808,3.605C401.806,1.389 399.408,0.005 397.488,1.111M335.431,112.152L322.858,119.395C322.486,119.61 322.257,120.007 322.257,120.437L322.256,134.946C322.256,135.562 322.937,135.947 323.471,135.639L336.043,128.396C336.416,128.182 336.632,127.784 336.631,127.355L336.631,112.845C336.631,112.23 335.964,111.845 335.431,112.152M328.103,98.764L309.275,87.869C308.718,87.547 308.029,87.547 307.472,87.869L288.643,98.764C287.845,99.226 287.845,100.379 288.643,100.842L307.472,111.736C308.029,112.059 308.718,112.059 309.275,111.736L328.103,100.842C328.902,100.379 328.902,99.226 328.103,98.764M358.415,100.728L366.78,105.568C367.275,105.855 367.887,105.855 368.383,105.568L376.748,100.728C377.458,100.317 377.458,99.291 376.748,98.88L368.383,94.04C367.887,93.753 367.275,93.753 366.78,94.04L358.415,98.88C357.705,99.291 357.705,100.317 358.415,100.728M351.685,112.377L360.059,117.201C360.556,117.488 360.861,118.017 360.861,118.59L360.851,128.254C360.85,129.074 359.963,129.587 359.252,129.178L350.878,124.354C350.382,124.068 350.087,123.536 350.087,122.965L350.086,113.301C350.086,112.482 350.975,111.967 351.685,112.377" />
            <path d="M266.509,102.829C266.176,101.997 265.469,101.693 264.679,102.164C263.889,102.634 249.041,111.48 249.041,111.48L249.041,103.328C249.041,102.413 248.458,102.08 247.627,102.413L242.802,104.16C242.137,104.409 241.887,104.908 241.887,105.574L241.887,141.417C241.887,142.166 242.386,142.664 243.135,142.664L247.793,142.664C248.541,142.664 249.041,142.166 249.041,141.417L249.041,119.463C249.041,119.463 266.548,108.657 267.258,108.232C267.967,107.808 268.33,107.448 268.006,106.652C267.652,105.779 266.509,102.829 266.509,102.829" />
            <path d="M8.625,117.958C10.205,112.219 14.697,108.725 21.02,108.725C27.924,108.725 31.583,112.801 31.916,117.958L8.625,117.958ZM39.486,120.121C39.486,110.139 32.665,101.737 21.269,101.737C10.039,101.737 0.723,109.807 0.723,122.949C0.723,134.928 8.542,143.661 21.685,143.661C27.674,143.661 33.663,141.582 38.155,137.589C38.737,137.09 38.737,136.425 38.321,135.842L36.075,132.349C35.659,131.684 34.994,131.601 34.329,132.1C30.253,135.094 26.094,136.591 21.685,136.591C13.283,136.591 8.708,131.101 8.126,124.197L38.256,124.197C39.026,124.197 39.486,123.639 39.486,122.966L39.486,120.121Z" />
            <path d="M65.726,136.591C58.656,136.591 52.583,131.767 52.583,122.616C52.583,113.466 58.656,108.725 65.726,108.725C73.129,108.725 78.869,113.466 78.869,122.616C78.869,131.85 73.129,136.591 65.726,136.591M80.034,159.3L84.692,159.3C85.44,159.3 85.939,158.801 85.939,158.052L85.939,103.319C85.939,102.403 85.357,102.07 84.442,102.403L79.701,104.151C79.036,104.4 78.786,104.899 78.786,105.565L78.786,107.311C76.207,103.818 71.132,101.737 65.643,101.737C54.746,101.737 45.263,109.89 45.263,122.699C45.263,134.013 52.583,143.661 65.227,143.661C70.966,143.661 76.456,141.083 78.786,138.172L78.786,158.052C78.786,158.801 79.285,159.3 80.034,159.3" />
            <path d="M109.636,143.662C113.961,143.662 118.703,142.248 121.781,137.757L121.781,141.417C121.781,142.165 122.28,142.664 123.029,142.664L127.687,142.664C128.436,142.664 128.934,142.165 128.934,141.417L128.934,103.402C128.934,102.404 128.352,102.071 127.52,102.404L122.696,104.151C122.031,104.4 121.781,104.899 121.781,105.565L121.781,125.529C121.781,132.599 117.206,136.592 110.967,136.592C104.812,136.592 100.653,132.683 100.653,125.529L100.653,103.319C100.653,102.404 100.07,102.071 99.239,102.404L94.414,104.151C93.748,104.4 93.498,104.899 93.498,105.565L93.498,125.778C93.498,137.59 100.653,143.662 109.636,143.662" />
            <path d="M138.666,98.162L143.74,96.498C144.571,96.248 144.904,95.832 144.904,95.001L144.904,88.929C144.904,88.18 144.322,87.598 143.407,87.931L138.416,89.761C137.668,90.01 137.252,90.343 137.252,91.174L137.252,96.997C137.252,97.912 137.751,98.494 138.666,98.162" />
            <path d="M138.749,142.664L143.407,142.664C144.155,142.664 144.655,142.164 144.655,141.416L144.655,103.318C144.655,102.403 144.072,102.07 143.241,102.403L138.416,104.15C137.751,104.399 137.501,104.898 137.501,105.564L137.501,141.416C137.501,142.164 138,142.664 138.749,142.664" />
            <path d="M154.469,142.663L159.127,142.663C159.876,142.663 160.375,142.164 160.375,141.416L160.375,119.871C160.375,112.801 164.95,108.808 171.189,108.808C177.344,108.808 181.503,112.718 181.503,119.871L181.503,141.416C181.503,142.164 182.002,142.663 182.751,142.663L187.409,142.663C188.157,142.663 188.657,142.164 188.657,141.416L188.657,119.622C188.657,107.809 181.503,101.737 172.52,101.737C168.195,101.737 163.453,103.151 160.375,107.643L160.375,103.318C160.375,102.403 159.793,102.07 158.961,102.403L154.136,104.15C153.471,104.399 153.222,104.898 153.222,105.564L153.222,141.416C153.222,142.164 153.72,142.663 154.469,142.663" />
            <path d="M215.313,136.674C207.078,136.674 202.087,130.519 202.087,122.699C202.087,114.88 207.078,108.725 215.313,108.725C223.464,108.725 228.456,114.88 228.456,122.699C228.456,130.519 223.464,136.674 215.313,136.674M215.313,101.737C203.334,101.737 194.767,110.638 194.767,122.699C194.767,134.761 203.334,143.661 215.313,143.661C227.292,143.661 235.776,134.761 235.776,122.699C235.776,110.638 227.292,101.737 215.313,101.737" />
          </Logo>
          <SrText>Equinor home page</SrText>
        </a>
      </Link>

      {children}
    </Bar>
  )
})
